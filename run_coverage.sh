#!/bin/bash

# First off, run the tests
make -j$(($(getconf _NPROCESSORS_ONLN)+1)) || exit 1
make check || exit 1

# Get some coverage on the CLI tooling
./src/cli/cve-check-tool
./src/cli/cve-check-tool help || exit 1
# Run unknown command
./src/cli/cve-check-tool bob
./src/cli/cve-check-tool help update || exit 1
# Unknown help
./src/cli/cve-check-tool help bob
./src/cli/cve-check-tool help help || exit 1
./src/cli/cve-check-tool version || exit 1

# Nuke old tree
if [[ -d coverage ]]; then
        rm -rf coverage
fi

# Regen html
make coverage || exit 1
